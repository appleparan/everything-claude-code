{
  "$schema": "https://json.schemastore.org/claude-code-settings.json",
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "tool == \"Bash\" && tool_input.command matches \"(uv run (manage\\.py runserver|uvicorn|gunicorn|flask run)|python -m (http\\.server|uvicorn|gunicorn))\"",
        "hooks": [
          {
            "type": "command",
            "command": "uv run python3 -c \"import sys; sys.stderr.write('[Hook] BLOCKED: Dev server must run in tmux for log access\\n[Hook] Use: tmux new-session -d -s dev \\\"uv run manage.py runserver\\\"\\n[Hook] Then: tmux attach -t dev\\n'); sys.exit(1)\""
          }
        ],
        "description": "Block dev servers outside tmux - ensures you can access logs"
      },
      {
        "matcher": "tool == \"Bash\" && tool_input.command matches \"pip install\"",
        "hooks": [
          {
            "type": "command",
            "command": "uv run python3 -c \"import sys; sys.stderr.write('[Hook] BLOCKED: Use uv instead of pip install\\n[Hook] Use: uv sync --group <group> or uv sync --extra <extra>\\n[Hook] Example: uv sync --group docs --group dev\\n[Hook] Example: uv sync --group docs --group dev --extra cu128\\n'); sys.exit(1)\""
          }
        ],
        "description": "Block pip install - always use uv sync instead"
      },
      {
        "matcher": "tool == \"Bash\" && tool_input.command matches \"(uv (sync|run pytest|run manage\\.py)|docker|make|pytest|tox)\"",
        "hooks": [
          {
            "type": "command",
            "command": "uv run python3 -c \"import os, sys; not os.environ.get('TMUX') and sys.stderr.write('[Hook] Consider running in tmux for session persistence\\n[Hook] tmux new -s dev  |  tmux attach -t dev\\n')\""
          }
        ],
        "description": "Reminder to use tmux for long-running commands"
      },
      {
        "matcher": "tool == \"Bash\" && tool_input.command matches \"git push\"",
        "hooks": [
          {
            "type": "command",
            "command": "uv run python3 -c \"import sys; sys.stderr.write('[Hook] Review changes before push...\\n[Hook] Continuing with push (remove this hook to add interactive review)\\n')\""
          }
        ],
        "description": "Reminder before git push to review changes"
      },
      {
        "matcher": "tool == \"Write\" && tool_input.file_path matches \"\\\\.(md|txt)$\" && !(tool_input.file_path matches \"README\\\\.md|CLAUDE\\\\.md|AGENTS\\\\.md|CONTRIBUTING\\\\.md\")",
        "hooks": [
          {
            "type": "command",
            "command": "uv run python3 -c \"import sys, json, re; d=sys.stdin.read(); i=json.loads(d); p=i.get('tool_input',{}).get('file_path',''); (re.search(r'\\.(md|txt)$',p) and not re.search(r'(README|CLAUDE|AGENTS|CONTRIBUTING)\\.md$',p)) and (sys.stderr.write('[Hook] BLOCKED: Unnecessary documentation file creation\\n[Hook] File: '+p+'\\n[Hook] Use README.md for documentation instead\\n') or sys.exit(1)); print(d,end='')\""
          }
        ],
        "description": "Block creation of random .md files - keeps docs consolidated"
      }
    ],
    "PostToolUse": [
      {
        "matcher": "tool == \"Bash\"",
        "hooks": [
          {
            "type": "command",
            "command": "uv run python3 -c \"import sys, json, re; d=sys.stdin.read(); i=json.loads(d); cmd=i.get('tool_input',{}).get('command',''); m=re.search(r'gh pr create',cmd) and re.search(r'https://github.com/[^/]+/[^/]+/pull/\\d+',i.get('tool_output',{}).get('output','')); m and sys.stderr.write('[Hook] PR created: '+m.group()+'\\n[Hook] To review: gh pr review '+m.group().split('/')[-1]+' --repo '+'/'.join(m.group().split('/')[3:5])+'\\n'); print(d,end='')\""
          }
        ],
        "description": "Log PR URL and provide review command after PR creation"
      },
      {
        "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\\\\.py$\"",
        "hooks": [
          {
            "type": "command",
            "command": "uv run python3 -c \"import sys, json, subprocess; d=sys.stdin.read(); i=json.loads(d); p=i.get('tool_input',{}).get('file_path',''); p and subprocess.run(['ruff','format',p],capture_output=True); print(d,end='')\""
          }
        ],
        "description": "Auto-format Python files with ruff format after edits"
      },
      {
        "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\\\\.py$\"",
        "hooks": [
          {
            "type": "command",
            "command": "uv run python3 -c \"import sys, json, subprocess; d=sys.stdin.read(); i=json.loads(d); p=i.get('tool_input',{}).get('file_path',''); r=subprocess.run(['ruff','check','--output-format=concise',p],capture_output=True,text=True) if p else None; r and r.stdout.strip() and sys.stderr.write(r.stdout.strip()+'\\n'); print(d,end='')\""
          }
        ],
        "description": "Lint Python files with ruff check after edits"
      },
      {
        "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\\\\.py$\"",
        "hooks": [
          {
            "type": "command",
            "command": "uv run python3 -c \"import sys, json, subprocess; d=sys.stdin.read(); i=json.loads(d); p=i.get('tool_input',{}).get('file_path',''); r=subprocess.run(['ty','check',p],capture_output=True,text=True) if p else None; r and r.stdout.strip() and sys.stderr.write(r.stdout.strip()+'\\n'); print(d,end='')\""
          }
        ],
        "description": "Type check Python files with ty after edits"
      },
      {
        "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\\\\.py$\"",
        "hooks": [
          {
            "type": "command",
            "command": "uv run python3 -c \"import sys, json, re; d=sys.stdin.read(); i=json.loads(d); p=i.get('tool_input',{}).get('file_path',''); lines=open(p).readlines() if p else []; matches=[(n+1,l.strip()) for n,l in enumerate(lines) if re.search(r'\\bprint\\s*\\(',l) and not re.search(r'#\\s*noqa',l)]; matches and (sys.stderr.write('[Hook] WARNING: print() found in '+p+'\\n'), [sys.stderr.write(str(n)+': '+l+'\\n') for n,l in matches[:5]], sys.stderr.write('[Hook] Remove print() before committing\\n')); print(d,end='')\""
          }
        ],
        "description": "Warn about print() statements after edits"
      },
      {
        "matcher": "tool == \"Bash\" && tool_input.command matches \"(uv run pytest|pytest|uv run manage\\.py test)\"",
        "hooks": [
          {
            "type": "command",
            "command": "uv run python3 -c \"import sys, json; d=sys.stdin.read(); sys.stderr.write('[Hook] Test run completed - review results above\\n'); print(d,end='')\"",
            "async": true,
            "timeout": 30
          }
        ],
        "description": "Notification after test run completion"
      }
    ],
    "Stop": [
      {
        "matcher": "*",
        "hooks": [
          {
            "type": "command",
            "command": "uv run python3 -c \"import subprocess, sys, re; r=subprocess.run(['git','diff','--name-only'],capture_output=True,text=True); files=[f for f in r.stdout.strip().split('\\n') if f.endswith('.py')]; found=False; [((matches:=[(n+1,l.strip()) for n,l in enumerate(open(f).readlines()) if re.search(r'\\bprint\\s*\\(',l) and not re.search(r'#\\s*noqa',l)]) and (sys.stderr.write('[Hook] print() in '+f+':\\n') or True) and [sys.stderr.write('  '+str(n)+': '+l+'\\n') for n,l in matches[:3]]) for f in files if f]; any(True for f in files if f and [(n,l) for n,l in enumerate(open(f).readlines()) if re.search(r'\\bprint\\s*\\(',l) and not re.search(r'#\\s*noqa',l)]) and sys.stderr.write('[Hook] Remove print() statements before committing\\n')\""
          }
        ],
        "description": "Check for print() in modified Python files after each response"
      }
    ]
  }
}

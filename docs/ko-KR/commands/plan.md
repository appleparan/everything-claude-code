---
description: Restate requirements, assess risks, and create step-by-step implementation plan. WAIT for user CONFIRM before touching any code.
---

# Plan 명령어

이 명령어는 **planner** Agent를 호출하여 코드를 작성하기 전에 포괄적인 구현 계획을 수립합니다.

## 이 명령어의 기능

1. **요구사항 재진술** - 무엇을 구축해야 하는지 명확히 함
2. **위험 식별** - 잠재적 문제와 장애물 파악
3. **단계별 계획 수립** - 구현을 단계로 분해
4. **확인 대기** - 계속하기 전에 사용자 승인을 받아야 함

## 언제 사용하나요

다음과 같은 경우 `/plan`을 사용하세요:
- 새로운 기능을 시작할 때
- 대규모 아키텍처 변경을 수행할 때
- 복잡한 리팩터링을 진행할 때
- 여러 파일/컴포넌트에 영향이 있을 때
- 요구사항이 불명확하거나 모호할 때

## 작동 방식

planner Agent는:

1. **요청을 분석**하고 명확한 언어로 요구사항을 재진술
2. **단계로 분해**, 구체적이고 실행 가능한 단계 포함
3. **의존성 식별**, 컴포넌트 간 관계
4. **위험 평가** 및 잠재적 장애물
5. **복잡도 추정** (높음/중간/낮음)
6. **계획을 제시**하고 명확한 확인을 대기

## 사용 예시

```
사용자: /plan 마켓이 해결될 때 실시간 알림을 추가해야 합니다

Agent (planner):
# 구현 계획: 실시간 마켓 해결 알림

## 요구사항 재진술
- 사용자가 관심 있는 마켓이 해결될 때 알림 전송
- 여러 알림 채널 지원 (인앱, Email, Webhook)
- 알림의 안정적인 전달 보장
- 마켓 결과 및 사용자 포지션 결과 포함

## 구현 단계

### 1단계: 데이터베이스 스키마
- notifications 테이블 추가, 필드: id, user_id, market_id, type, status, created_at
- user_notification_preferences 테이블 추가 (채널 설정용)
- user_id 및 market_id에 인덱스 생성하여 성능 최적화

### 2단계: 알림 서비스
- lib/notifications.ts에 알림 서비스 생성
- BullMQ/Redis를 사용하여 알림 큐 구현
- 전달 실패에 대한 재시도 로직 추가
- 알림 템플릿 생성

### 3단계: 통합 포인트
- 마켓 해결 로직에 연결 (상태가 "resolved"로 변경될 때)
- 해당 마켓에 포지션이 있는 모든 사용자 조회
- 각 사용자에 대해 알림 큐에 추가

### 4단계: 프론트엔드 컴포넌트
- 헤더에 NotificationBell 컴포넌트 생성
- NotificationList 팝업 추가
- Supabase 구독을 통한 실시간 업데이트 구현
- 알림 설정 페이지 추가

## 의존성
- Redis (큐용)
- Email 서비스 (SendGrid/Resend)
- Supabase 실시간 구독

## 위험
- 높음: Email 전달률 (SPF/DKIM 필요)
- 중간: 마켓당 1000+명 사용자 시 성능
- 중간: 마켓이 자주 해결될 경우 알림 스팸 가능성
- 낮음: 실시간 구독 오버헤드

## 추정 복잡도: 중간
- 백엔드: 4-6시간
- 프론트엔드: 3-4시간
- 테스트: 2-3시간
- 합계: 9-13시간

**확인 대기**: 이 계획으로 진행하시겠습니까? (예/아니오/수정)
```

## 중요 사항

**핵심**: planner Agent는 사용자가 "예", "진행" 또는 유사한 긍정적 응답으로 계획을 명시적으로 확인할 때까지 어떤 코드도 작성하지 **않습니다**.

수정을 원하시면 다음과 같이 응답하세요:
- "수정: [변경 사항]"
- "다른 접근 방식: [대안]"
- "2단계를 건너뛰고 3단계를 먼저 진행"

## 다른 명령어와의 통합

계획 수립 후:
- `/tdd`를 사용하여 테스트 주도 개발로 구현
- 빌드 오류 발생 시 `/build-fix` 사용
- `/code-review`를 사용하여 완성된 구현 리뷰

## 관련 Agent

이 명령어는 다음 위치의 `planner` Agent를 호출합니다:
`~/.claude/agents/planner.md`
